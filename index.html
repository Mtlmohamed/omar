<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Paint Ingredient Calculator</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <div class="container">
        <h1>Paint Ingredient Calculator</h1>
        <form id="paintForm">
            <h2>Current Formula</h2>
            <div id="currentFormulaContainer"></div>
            <button type="button" onclick="addCurrentFormula()">Add Colorant</button>
            
            <h2>Destination Formula</h2>
            <div id="destinationFormulaContainer"></div>
            <button type="button" onclick="addDestinationFormula()">Add Colorant</button>

            <button type="button" onclick="calculateDifference()">Calculate Difference</button>
        </form>

        <div id="result"></div>
    </div>

    <script>
        let currentFormulaCount = 0;
        let destinationFormulaCount = 0;

        function addCurrentFormula() {
            if (currentFormulaCount < 10) {
                const container = document.getElementById('currentFormulaContainer');
                container.innerHTML += createFormulaSection('current', currentFormulaCount);
                currentFormulaCount++;
            }
        }

        function addDestinationFormula() {
            if (destinationFormulaCount < 10) {
                const container = document.getElementById('destinationFormulaContainer');
                container.innerHTML += createFormulaSection('destination', destinationFormulaCount);
                destinationFormulaCount++;
            }
        }

        function createFormulaSection(type, index) {
            return `
                <div class="formula">
                    <div class="row">
                        <label for="${type}Colorant${index}">Colorant:</label>
                        <select id="${type}Colorant${index}" name="${type}Colorant${index}">
                            <option value="B1">B1 (Black)</option>
                            <option value="R2">R2 (New Red)</option>
                            <option value="Y1">Y1 (Yellow)</option>
                            <option value="Y3">Y3 (Deep Gold)</option>
                            <option value="W1">W1 (White)</option>
                            <option value="N1">N1 (Raw Amber)</option>
                            <option value="R2">R2 (Maroon)</option>
                            <option value="L1">L1 (Bleu)</option>
                            <option value="G2">G2 (New Green)</option>
                            <option value="R3">R3 (Magenta)</option>
                        </select>
                    </div>
                    <div class="row">
                        <label for="${type}OZ${index}">OZ:</label>
                        <input type="number" id="${type}OZ${index}" name="${type}OZ${index}" max="32">
                    </div>
                    <div class="row">
                        <label for="${type}32${index}">32:</label>
                        <input type="number" id="${type}32${index}" name="${type}32${index}" max="32">
                    </div>
                    <div class="row">
                        <label for="${type}64${index}">64:</label>
                        <input type="number" id="${type}64${index}" name="${type}64${index}" max="2">
                    </div>
                    <div class="row">
                        <label for="${type}128${index}">128:</label>
                        <input type="number" id="${type}128${index}" name="${type}128${index}" max="4">
                    </div>
                </div>
            `;
        }

        function calculateDifference() {
            let resultText = '<h2>Difference</h2>';
            let doable = true;

            for (let i = 0; i < Math.max(currentFormulaCount, destinationFormulaCount); i++) {
                const currentOZ = parseInt(document.getElementById(`currentOZ${i}`)?.value) || 0;
                const current32 = parseInt(document.getElementById(`current32${i}`)?.value) || 0;
                const current64 = parseInt(document.getElementById(`current64${i}`)?.value) || 0;
                const current128 = parseInt(document.getElementById(`current128${i}`)?.value) || 0;

                const destinationOZ = parseInt(document.getElementById(`destinationOZ${i}`)?.value) || 0;
                const destination32 = parseInt(document.getElementById(`destination32${i}`)?.value) || 0;
                const destination64 = parseInt(document.getElementById(`destination64${i}`)?.value) || 0;
                const destination128 = parseInt(document.getElementById(`destination128${i}`)?.value) || 0;

                // Convert all to droplets
                let currentTotalDrops = (currentOZ * 32) + current32 + (current64 * 2) + (current128 * 0.5);
                let destinationTotalDrops = (destinationOZ * 32) + destination32 + (destination64 * 2) + (destination128 * 0.5);

                let diffDrops = destinationTotalDrops - currentTotalDrops;

                if (diffDrops < 0) {
                    doable = false;
                    resultText += `
                        <h3>Colorant Set ${i + 1}</h3>
                        <p>This set of ingredients is not doable.</p>
                    `;
                    continue;
                }

                // Initialize the differences
                let diffOZ = 0;
                let diff32 = 0;
                let diff64 = 0;
                let diff128 = 0;

                // Calculate the differences
                while (diffDrops >= 32) {
                    diffOZ += 1;
                    diffDrops -= 32;
                }
                while (diffDrops >= 1) {
                    diff32 += 1;
                    diffDrops -= 1;
                }
                while (diffDrops >= 0.5) {
                    diff64 += 1;
                    diffDrops -= 0.5;
                }
                while (diffDrops >= 0.25) {
                    diff128 += 1;
                    diffDrops -= 0.25;
                }

                // Ensure correct balance when the destination requires smaller units that are not available in the current formula
                if (current128 > 0 && destination32 > 0) {
                    diff64 += 1;
                    diff128 += 1;
                }

                resultText += `
                    <h3>Colorant Set ${i + 1}</h3>
                    <p>OZ: ${diffOZ}</p>
                    <p>32: ${diff32}</p>
                    <p>64: ${diff64}</p>
                    <p>128: ${diff128}</p>
                    <p style="color: green;">The color is savable.</p>
                `;
            }

            document.getElementById('result').innerHTML = resultText;
        }
    </script>
</body>
</html>
